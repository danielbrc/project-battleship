(()=>{"use strict";var t={56(t,e,n){t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72(t){var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var s={},r=[],o=0;o<t.length;o++){var l=t[o],c=i.base?l[0]+i.base:l[0],d=s[c]||0,h="".concat(c," ").concat(d);s[c]=d+1;var p=n(h),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(u);else{var m=a(u,i);i.byIndex=o,e.splice(o,0,{identifier:h,updater:m,references:1})}r.push(h)}return r}function a(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,a){var s=i(t=t||[],a=a||{});return function(t){t=t||[];for(var r=0;r<s.length;r++){var o=n(s[r]);e[o].references--}for(var l=i(t,a),c=0;c<s.length;c++){var d=n(s[c]);0===e[d].references&&(e[d].updater(),e.splice(d,1))}s=l}}},113(t){t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n}).join("")},e.i=function(t,n,i,a,s){"string"==typeof t&&(t=[[null,t,void 0]]);var r={};if(i)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(r[l]=!0)}for(var c=0;c<t.length;c++){var d=[].concat(t[c]);i&&r[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),a&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=a):d[4]="".concat(a)),e.push(d))}},e}},365(t,e,n){n.d(e,{A:()=>o});var i=n(601),a=n.n(i),s=n(314),r=n.n(s)()(a());r.push([t.id,"body {\n  margin: 0;\n  padding: 0;\n}\n\n.container {\n  height: 100vh;\n  background: lightskyblue;\n}\n\n.placement {\n\n}\n\n.start {\n  display: grid;\n  gap: 20px 60px;\n  justify-content: center;\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: 1fr 1fr;\n  align-items: end;\n}\n\n.start > div:nth-child(odd) {\n  justify-self: right;\n}\n\n.start > div:nth-child(even) {\n  justify-self: left;\n}\n\n.placement > div {\n  justify-self: center;\n}\n\n.placement .hit:hover {\n  cursor: grab;\n}\n\n.placement .hit:active {\n  cursor: grabbing;\n}\n\n.board {\n  background-color: cadetblue;\n  display: grid;\n}\n\n.board.active {\n  background-color: beige;\n}\n\n.board, .display {\n  width: 352px;\n}\n\n.cell-wrapper {\n  display: grid;\n  grid-template-columns: repeat(10, 30px);\n  grid-template-rows: repeat(10, 30px);\n  background-color: blanchedalmond;\n  gap: 2px;\n  height: 318px;\n  width: 320px;\n  padding-left: 2px;\n  padding-bottom: 2px;\n}\n\n.column {\n  display: grid;\n  grid-template-columns: repeat(10, 30px);\n  grid-column: 2 / 3;\n  gap: 2px;\n  align-items: center;\n  justify-items: center;\n}\n\n.row {\n  display: grid;\n  grid-template-rows: repeat(10, 30px);\n  gap: 2px;\n  align-items: center;\n  justify-items: center;\n  width: 30px;\n}\n\nh3, input {\n  text-align: center;\n  grid-column: 1 / 3;\n  /* grid-row: 1 / 3; */\n}\n\n.board input {\n  width: 50%;\n  align-self: center;\n  justify-self: center;\n  margin: 20px 0;\n}\n\n.cell {\n  background: navy;\n  height: 30px;\n  width: 30px;\n}\n\n.preview {\n  background-color: gray;\n}\n\n.start:not(.active) .cell:hover, button:hover, .cell.preview {\n  opacity: 0.6;\n}\n\n.cell.hit {\n  background-color: chartreuse;\n}\n\n.cell.miss {\n  background-color: brown;\n}\n\n.display {\n  align-self: self-start;\n  display: flex;\n  gap: 8px;\n  flex-wrap: wrap;\n  align-content: center;\n  justify-content: center;\n}\n\n.display span {\n  display: inline-block;\n  background-color: navy;\n  border-radius: 15px;\n  color: white;\n  user-select: none;\n  padding: 4px 12px;\n}\n\nspan.sink {\n  background-color: brown;\n  opacity: 0.4;\n  text-decoration: line-through;\n}\n\n.winner {\n  width: 100vw;\n  height: 100vh;\n  overflow: hidden;\n  text-align: center;\n  z-index: 1;\n  position: absolute;\n  top: 0;\n  left: 0;\n  backdrop-filter: grayscale(40%) blur(7px);\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding-top: 25%;\n}\n\n.winner h3 {\n  color: white;\n  text-shadow: 0 0 5px black;\n}\n\n.winner button, .options button {\n  background-color: navy;\n  border-radius: 15px;\n  color: white;\n  padding: 8px 16px;\n  border: none;\n}\n\n.options {\n  display: inline-flex;\n  gap: 20px;\n  width: 100%;\n  justify-content: center;\n  padding: 20px 0;\n}\n\n.options button {\n  height: 30px;\n}\n\n.options label {\n  line-height: 30px;\n}",""]);const o=r},540(t){t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601(t){t.exports=function(t){return t[1]}},659(t){var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},825(t){t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,a&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function n(i){var a=e[i];if(void 0!==a)return a.exports;var s=e[i]={id:i,exports:{}};return t[i](s,s.exports,n),s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;var i=n(72),a=n.n(i),s=n(825),r=n.n(s),o=n(659),l=n.n(o),c=n(56),d=n.n(c),h=n(540),p=n.n(h),u=n(113),m=n.n(u),g=n(365),y={};y.styleTagTransform=m(),y.setAttributes=d(),y.insert=l().bind(null,"head"),y.domAPI=r(),y.insertStyleElement=p(),a()(g.A,y),g.A&&g.A.locals&&g.A.locals;const f=class{constructor(t=1,e=0,n=!1){this.length=t,this.hits=e,this.sunk=n}hit(){this.hits+=1,this.isSunk()}isSunk(){return this.sunk||(this.sunk=this.hits==this.length),this.sunk}},v=["A","B","C","D","E","F","G","H","I","J"],b=["1","2","3","4","5","6","7","8","9","10"];function w(){return Math.floor(10*Math.random())}const x=class{constructor(){this.ships={carrier:new f(5),battleship:new f(4),cruiser:new f(3),destroyer:new f(2),frigate:new f(1)},this.coordinates=new Map,this.missed=new Set}receiveAttack(t){const e=this.coordinates.get(t);return void 0!==e?this.ships[e.ship].hit():this.attackMiss(t),e}placeRandomShips(){15==this.coordinates.size&&this.coordinates.clear();for(const t of Object.entries(this.ships)){let{coordinate:e,orientation:n}=this.createRandomCoordinates(t[1].length);for(const i of e)this.coordinates.set(i,{ship:t[0],orientation:n})}}replaceShip(t,e,n=0){const i=this.coordinates,a=this.ships[t].length;let s=0;for(const e of i.keys())if(i.get(e).ship==t&&(this.coordinates.delete(e),s++),s==a)break;for(const i of e)this.coordinates.set(i,{ship:t,orientation:n})}createRandomCoordinates(t){const e=w()%2;let n=w(),i=w();const a=[];for(let s=0;s<t;s++){const r=0==e?v.at(n+s)+b.at(i):v.at(n)+b.at(i+s);if(this.coordinates.get(r)||-1!=r.indexOf("undefined"))return this.createRandomCoordinates(t);a.push(r)}return{coordinate:a,orientation:e}}attackMiss(t){this.missed.add(t)}allShipsSunk(){for(const t of Object.entries(this.ships))if(!t[1].isSunk())return!1;return!0}},E=class{constructor(t,e){this.type="player"===t?"player":"computer",this.name=e,this.board=new x}};class C{constructor(t,e){this.container=t,this.player=e.name,this.board=e.board,this.content=null,this.dragged=null,this.init()}init(){this.content=document.createElement("div"),this.content.classList.add("board"),this.container.appendChild(this.content)}placeShips(){this.content.id=this.player.replace(/\W/g,"_"),this.container.classList.add("placement"),this.content.innerText="";const t=N(),{coordinates:e,ships:n}=this.board,i=document.createElement("div");i.classList.add("cell-wrapper");const a=document.createElement("input");a.classList.add("playerName"),a.value=this.player,a.addEventListener("focus",this.focusPlayerName),a.addEventListener("blur",this.changePlayerName.bind(this)),this.content.appendChild(a);const s=this.templateGrid("column",L),r=this.templateGrid("row",O);this.content.appendChild(s),this.content.appendChild(r);for(const a of t){const t=document.createElement("div"),s=e.get(a);t.classList.add("cell"),t.id=a,s&&(t.classList.add("hit"),t.dataset.ship=s.ship,t.dataset.length=n[s.ship].length,t.dataset.orientation=s.orientation,t.setAttribute("draggable","true"),t.addEventListener("dragstart",this.dragShipStart.bind(this)),t.addEventListener("dragend",this.dragShipEnd.bind(this))),i.appendChild(t)}i.addEventListener("dragover",this.dragOverCell.bind(this)),this.content.appendChild(i),this.container.appendChild(this.content)}build(t){this.content.id=this.player.replace(/\W/g,"_"),this.container.classList.add("start"),this.content.innerText="";const e=N(),n=document.createElement("div");n.classList.add("cell-wrapper"),this.player==t&&this.content.classList.add("active");const i=document.createElement("h3");i.innerText=this.player,this.content.appendChild(i);const a=this.templateGrid("column",L),s=this.templateGrid("row",O);this.content.appendChild(a),this.content.appendChild(s);for(const t of e){const e=document.createElement("div");e.classList.add("cell"),e.id=t,e.addEventListener("click",this.eventShot),n.appendChild(e)}this.content.appendChild(n)}eventShot({target:t}){if(t.classList.length>1)return!1;const e=t.id,n=t.parentNode.parentNode.id,i=new CustomEvent("shotTrigger",{detail:{cellId:e,playerAttacked:n}});document.dispatchEvent(i),t.removeEventListener("click",this.eventShot)}updateCell(t,e){const n=this.player.replace(/\W/g,"_");document.querySelector(`#${n} #${t}`).classList.add(e?"hit":"miss")}focusPlayerName({target:t}){const e=t.value;t.dataset.oldName=e,t.value=""}changePlayerName({target:t}){const e=t.dataset.oldName;if(""!=t.value&&t.value!=e){this.player=t.value;const n=new CustomEvent("changeName",{detail:{oldName:e,newName:this.player}});document.dispatchEvent(n)}else""==t.value&&(t.value=e);delete t.dataset.oldName}dragShipStart(t){this.dragged=t.target;const{dataset:e,id:n}=t.target}dragShipEnd(t){const{id:e}=t.target,{dataset:n}=this.dragged,i=document.querySelectorAll(".preview");if(i.length==n.length){const t=[];i.forEach(e=>t.push(e.id)),this.board.replaceShip(n.ship,t,function(t){if(t.length<=1)return 0;const e=t[0].split(""),n=t[1].split("");return e[0]==n[0]?1:0}(t))}const a=new CustomEvent("placeShip",{detail:{player:this.player}});document.dispatchEvent(a),this.dragged=null}dragOverCell(t){const{type:e,target:n}=t,{dataset:i}=this.dragged;this.highlightCell(n.id,i),t.preventDefault()}highlightCell(t,{ship:e,length:n,orientation:i}){if(!t)return;let a=document.querySelectorAll(".preview, .miss");this.cleanCells(a);let s=function(t,e,n){let i=[t];if(e<=1)return i;const a=t.at(0),s=t.substr(1);let r=L.indexOf(a),o=O.indexOf(s);for(let t=1;t<e;t++)0==n?r+=1:o+=1,L[r]&&O[o]&&(i=[...i,L.at(r)+O.at(o)]);return i}(t,n,i);for(let t of s){const e=document.querySelector(`#${t}`);e&&!e.dataset.ship&&e.classList.add("preview")}a=document.querySelectorAll(".preview"),a.length<n&&(this.cleanCells(a),a.forEach(t=>t.classList.add("miss")))}cleanCells(t){t.forEach(t=>{t.classList.remove("preview"),t.classList.remove("miss")})}templateGrid(t,e){const n=document.createElement("div");n.classList.add(t);for(const t of e){const e=document.createElement("span");e.innerText=t,n.appendChild(e)}return n}}class S{constructor(t,{name:e,board:n}){this.container=t,this.player=e,this.playerId=e.replace(/\W/g,"_"),this.ships=n.ships,this.build()}build(){const t=document.createElement("div");t.classList.add("display"),t.id=`${this.playerId}Display`;for(const e of Object.entries(this.ships)){const n=document.createElement("span");n.innerText=e[0],n.dataset.hits=e[1].length,t.appendChild(n)}this.container.appendChild(t)}updateShip(t){if(t&&this.ships[t.ship].isSunk()){const e=this.playerId,n=document.querySelector(`#${e}Display`).childNodes;for(const e of n)e.innerText==t.ship&&e.classList.add("sink")}}}class T{constructor(t,{name:e,board:n},i=!1){this.container=t,this.player=e,this.board=n,this.firstTurn=i,this.vsComputer=!0,this.build()}build(){const t=document.createElement("div");t.classList.add("options");const e=document.createElement("button");e.innerText="Random positions",e.addEventListener("click",this.eventPlaceRandomShips.bind(this)),t.appendChild(e);const n=document.createElement("button");if(n.innerText="Next",n.addEventListener("click",this.nextStep.bind(this)),t.appendChild(n),this.firstTurn){const e=document.createElement("label"),n=document.createElement("input");n.setAttribute("type","checkbox"),e.innerText="vs Computer",n.value="true",n.id="vsComputer",n.checked=!0,n.addEventListener("click",()=>this.vsComputer=!this.vsComputer),e.prepend(n),t.appendChild(e)}this.container.appendChild(t)}eventPlaceRandomShips(){this.board.placeRandomShips();const t=new CustomEvent("placeRandom",{detail:{player:this.player}});document.dispatchEvent(t)}changePlayerName(t){this.player=t,console.log("OPTIONS > change name to: ",this.player)}nextStep(){const t=new CustomEvent("nextStep",{detail:{player:this.player,versus:this.vsComputer}});document.dispatchEvent(t)}}class k{constructor(t){this.playerTarget=t,this.targetBoard=N(),this.hits=[],this.nextTarget=null}play(){const t=this.hits.length>0?this.lastTargetCell():this.randomCell();this.shot(t)}shot(t){const e=new CustomEvent("shotTrigger",{detail:{cellId:t,playerAttacked:this.playerTarget}});document.dispatchEvent(e)}hitTarget(t){this.hits.push(t)}lastTargetCell(){const t=this.possibleMoves(this.hits.at(-1)),e=Math.floor(Math.random()*t.length);if(t.at(e)){const n=this.targetBoard.indexOf(t.at(e));this.targetBoard.splice(n,1)}return t.at(e)||this.randomCell()}randomCell(){const t=Math.floor(Math.random()*this.targetBoard.length);return this.targetBoard.splice(t,1)[0]}possibleMoves(t){let e=L.indexOf(t.at(0)),n=O.indexOf(t.substr(1));return[[1,0],[0,1],[-1,0],[0,-1]].map(t=>{const i=L[e+t[0]],a=O[n+t[1]];if(i&&a)return i+a}).filter(t=>this.targetBoard.includes(t))}}const L=["A","B","C","D","E","F","G","H","I","J"],O=["1","2","3","4","5","6","7","8","9","10"];function N(){const t=[];for(const e of O)for(const n of L)t.push(`${n}${e}`);return t}const A=new E("player","PlayerOne"),M=new E("computer","PlayerTwo"),R=document.querySelector(".container"),B=new class{constructor(t,e,n){this.container=t,this.playerOne=e,this.playerTwo=n,this.gameMode="computer",this.turn=e.name,this.playerOneBoard=new C(t,e),this.playerTwoBoard=new C(t,n),this.playerOneDisplay=null,this.playerTwoDisplay=null,this.automata=null}init(){console.log("App init"),this.placements(),this.registerEvents()}start(){console.log("App start"),this.turn=this.playerOne.name,this.container.classList.remove("placement"),this.build()}placements(t="playerOne",e=!0){this.container.innerText="",this[`${t}Board`].placeShips(this.turn),this[`${t}Display`]=new T(this.container,this[t],e)}build(){this.container.innerText="",this.playerOneBoard.init(),this.playerTwoBoard.init(),this.playerOneBoard.build(this.turn),this.playerTwoBoard.build(this.turn),this.playerOneDisplay=new S(this.container,this.playerOne),this.playerTwoDisplay=new S(this.container,this.playerTwo)}registerEvents(){console.log("RegisterEvents!"),document.addEventListener("shotTrigger",this.shotEvent.bind(this)),document.addEventListener("placeShip",this.placeShip.bind(this)),document.addEventListener("placeRandom",this.placeRandom.bind(this)),document.addEventListener("changeName",this.changePlayerName.bind(this)),document.addEventListener("nextStep",this.nextStep.bind(this))}shotEvent({detail:t}){if(t.playerAttacked==this.turn)return!1;const e=t.cellId;this.turn=t.playerAttacked;const n=this.turn==this.playerOne.name?"playerOne":"playerTwo",i=this[n].board.receiveAttack(e);this[n].board.allShipsSunk()&&this.winner(),this.toggle(),this[`${n}Board`].updateCell(e,i),this[`${n}Display`].updateShip(i),"computer"==this.gameMode&&(this.turn==this.playerTwo.name.replace(/\W/g,"_")?this.automata.play():"computer"==this.gameMode&&i&&this.automata.hitTarget(e))}placeShip({detail:t}){const e=t.player==this.playerOne.name?"playerOne":"playerTwo";this.container.innerText="",this.placements(e)}placeRandom({detail:t}){const e=t.player==this.playerOne.name?"playerOne":"playerTwo";this.container.innerText="",this.placements(e)}changePlayerName({detail:t}){const{oldName:e,newName:n}=t,i=e==this.playerOne.name?"playerOne":"playerTwo";this[i].name=this.turn=n,this[`${i}Display`].changePlayerName(n)}nextStep({detail:t}){t.player!=this.playerOne.name||t.versus?(t.player==this.playerTwo.name||(this.playerTwo.name="Mr. Robot",this.playerTwoBoard.player=this.playerTwo.name,this.automata=new k(this.playerOne.name)),this.start()):(this.playerTwo.type="player",this.gameMode="versus",this.placements("playerTwo",!1))}toggle(){document.querySelectorAll(".board").forEach(t=>{t.classList.toggle("active")})}winner(){const t=document.createElement("div");t.classList.add("winner");const e=this.turn==this.playerOne.name?this.playerTwo.name:this.playerOne.name;t.innerHTML=`<h3>${e} Wins!</h3>`;const n=document.createElement("button");n.innerText="Start new game",n.addEventListener("click",()=>{window.navigation.reload()}),t.appendChild(n),this.container.appendChild(t)}}(R,A,M);A.board.placeRandomShips(),M.board.placeRandomShips(),B.init()})();